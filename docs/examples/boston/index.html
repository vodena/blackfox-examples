<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.16.0 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Boston Example - BlackFox examples</title>
<meta name="description" content="">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="BlackFox examples">
<meta property="og:title" content="Boston Example">
<meta property="og:url" content="/blackfox-examples/examples/boston/">


  <meta property="og:description" content="">







  <meta property="article:published_time" content="2019-04-22T09:24:49+02:00">






<link rel="canonical" href="/blackfox-examples/examples/boston/">







  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "Vodéna",
      "url": null,
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->


<link href="/blackfox-examples/feed.xml" type="application/atom+xml" rel="alternate" title="BlackFox examples Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/blackfox-examples/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--example wide">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/blackfox-examples/"><img src="/blackfox-examples/assets/images/apple-touch-icon.png" alt=""></a>
        
        <a class="site-title" href="/blackfox-examples/">BlackFox Examples</a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/blackfox-examples/posts/" >Posts</a>
            </li><li class="masthead__menu-item">
              <a href="/blackfox-examples/examples/" >Examples</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      





<div id="main" role="main">
  

  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    
    <!-- <meta itemprop="headline" content="Boston Example"> -->
    
    
    <!-- <meta itemprop="description" content=""> -->
    
    
    

    <div class="page__inner-wrap">
      
      <!-- <header>
        <h1 id="page-title" class="page__title" itemprop="headline">
          Boston Example
</h1>
        
      </header> -->
      

      <section class="page__content" itemprop="text">
        

        


        <div>

          
<h1 id="boston-housing">Boston housing</h1>

<h4 id="problem-explanation">Problem explanation:</h4>

<p>The Boston housing data set is a data set that has median value of the house along with 13 other parameters that could potentially be related to housing prices. These are the factors such as socio-economic conditions, environmental conditions, educational facilities and some other similar factors. There are 506 observations in the data for 14 variables including the median price of house in Boston. There are 12 numerical variables in our dataset and 1 categorical variable. The aim of this project is to build a model estimate the median price of owner-occupied homes in Boston.</p>

<p>Data set is used in Regression Diagnostics-Identifying Influential Data and Sources of Collinearity 1980 by the Belsley D.A. and Welsch R.E. and in Hedonic prices and the demand for clean air 1978 by the Harrison D. and Rubinfeld D.L. The data set itself is located here, in the field Data.</p>

<p>This is regression problem and the result is one output which presents median value of owner-occupied homes in 1000’s dollars.</p>

<p>Model inputs are:</p>
<ul>
  <li>Crim – per capita crime rate by town,</li>
  <li>Zn – proportion of residential land zoned for lots over 25000 square feet,</li>
  <li>Indus – proportion of non-retail business acres per town,</li>
  <li>Chas  – Charles River dummy variable (1 if tract bounds river; 0 otherwise),</li>
  <li>Nox – nitric oxides concentration (parts per 10 million),</li>
  <li>Rm – average number of rooms per dwelling,</li>
  <li>Age - proportion of owner-occupied units built prior to 1940,</li>
  <li>Dis - weighted distances to five Boston employment centres,</li>
  <li>Rad – index of accessibility to radial highways,</li>
  <li>Tax – full-value property-tax rate per 10000 dollars,</li>
  <li>Ptratio – pupil-teacher ratio by town,</li>
  <li>Black –1000(Bk - 0.63)2 where Bk is the proportion of black people by town,</li>
  <li>Lstat - % lower status of the population.</li>
</ul>

<h4 id="problem-solution">Problem solution:</h4>
<p>Data set is relatively small, it contains 506 observations.  We have divided the data set in two sets, training set, which contains 404 observations and test set, which contains 102 observations. We solved problem in two ways:</p>

<ul>
  <li>Manually buiilding ANN,</li>
  <li>Employing Black Fox service.</li>
</ul>

<p>We evaluate the performance of the models using K-fold cross validation. For the purpose of feature scaling, we apply a min max scaler. To stop the training at the right time, Keras’ early stopping scheme is applied.</p>

<h3 id="update-keras-to-latest-version">Update Keras to latest version:</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="n">keras</span><span class="o">==</span><span class="mf">2.2.4</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Requirement already satisfied: keras==2.2.4 in /home/nbuser/anaconda3_501/lib/python3.6/site-packages (2.2.4)
Requirement already satisfied: keras-applications&gt;=1.0.6 in /home/nbuser/anaconda3_501/lib/python3.6/site-packages (from keras==2.2.4) (1.0.7)
Requirement already satisfied: h5py in /home/nbuser/anaconda3_501/lib/python3.6/site-packages (from keras==2.2.4) (2.8.0)
Requirement already satisfied: numpy&gt;=1.9.1 in /home/nbuser/anaconda3_501/lib/python3.6/site-packages (from keras==2.2.4) (1.14.6)
Requirement already satisfied: keras-preprocessing&gt;=1.0.5 in /home/nbuser/anaconda3_501/lib/python3.6/site-packages (from keras==2.2.4) (1.0.9)
Requirement already satisfied: six&gt;=1.9.0 in /home/nbuser/anaconda3_501/lib/python3.6/site-packages (from keras==2.2.4) (1.11.0)
Requirement already satisfied: scipy&gt;=0.14 in /home/nbuser/anaconda3_501/lib/python3.6/site-packages (from keras==2.2.4) (1.1.0)
Requirement already satisfied: pyyaml in /home/nbuser/anaconda3_501/lib/python3.6/site-packages (from keras==2.2.4) (3.13)
</code></pre></div></div>

<h1 id="data-preprocessing">Data preprocessing</h1>
<h4 id="importing-data-frame">Importing data frame</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Importing the libraries
</span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="n">sns</span>

<span class="c1"># Importing the date as data frame wich we will import with pandas using the read_csv function.
</span><span class="n">dataframe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'Boston_dataset.csv'</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="dataset-info">Dataset info</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dataframe</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 506 entries, 0 to 505
Data columns (total 14 columns):
crim       506 non-null float64
zn         506 non-null float64
indus      506 non-null float64
chas       506 non-null int64
nox        506 non-null float64
rm         506 non-null float64
age        506 non-null float64
dis        506 non-null float64
rad        506 non-null int64
tax        506 non-null int64
ptratio    506 non-null float64
black      506 non-null float64
lstat      506 non-null float64
medv       506 non-null float64
dtypes: float64(11), int64(3)
memory usage: 55.4 KB
</code></pre></div></div>

<h4 id="dataset-description">Dataset description</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dataframe</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>crim</th>
      <th>zn</th>
      <th>indus</th>
      <th>chas</th>
      <th>nox</th>
      <th>rm</th>
      <th>age</th>
      <th>dis</th>
      <th>rad</th>
      <th>tax</th>
      <th>ptratio</th>
      <th>black</th>
      <th>lstat</th>
      <th>medv</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>506.000000</td>
      <td>506.000000</td>
      <td>506.000000</td>
      <td>506.000000</td>
      <td>506.000000</td>
      <td>506.000000</td>
      <td>506.000000</td>
      <td>506.000000</td>
      <td>506.000000</td>
      <td>506.000000</td>
      <td>506.000000</td>
      <td>506.000000</td>
      <td>506.000000</td>
      <td>506.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>3.613524</td>
      <td>11.363636</td>
      <td>11.136779</td>
      <td>0.069170</td>
      <td>0.554695</td>
      <td>6.284634</td>
      <td>68.574901</td>
      <td>3.795043</td>
      <td>9.549407</td>
      <td>408.237154</td>
      <td>18.455534</td>
      <td>356.674032</td>
      <td>12.653063</td>
      <td>22.532806</td>
    </tr>
    <tr>
      <th>std</th>
      <td>8.601545</td>
      <td>23.322453</td>
      <td>6.860353</td>
      <td>0.253994</td>
      <td>0.115878</td>
      <td>0.702617</td>
      <td>28.148861</td>
      <td>2.105710</td>
      <td>8.707259</td>
      <td>168.537116</td>
      <td>2.164946</td>
      <td>91.294864</td>
      <td>7.141062</td>
      <td>9.197104</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.006320</td>
      <td>0.000000</td>
      <td>0.460000</td>
      <td>0.000000</td>
      <td>0.385000</td>
      <td>3.561000</td>
      <td>2.900000</td>
      <td>1.129600</td>
      <td>1.000000</td>
      <td>187.000000</td>
      <td>12.600000</td>
      <td>0.320000</td>
      <td>1.730000</td>
      <td>5.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>0.082045</td>
      <td>0.000000</td>
      <td>5.190000</td>
      <td>0.000000</td>
      <td>0.449000</td>
      <td>5.885500</td>
      <td>45.025000</td>
      <td>2.100175</td>
      <td>4.000000</td>
      <td>279.000000</td>
      <td>17.400000</td>
      <td>375.377500</td>
      <td>6.950000</td>
      <td>17.025000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>0.256510</td>
      <td>0.000000</td>
      <td>9.690000</td>
      <td>0.000000</td>
      <td>0.538000</td>
      <td>6.208500</td>
      <td>77.500000</td>
      <td>3.207450</td>
      <td>5.000000</td>
      <td>330.000000</td>
      <td>19.050000</td>
      <td>391.440000</td>
      <td>11.360000</td>
      <td>21.200000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>3.677082</td>
      <td>12.500000</td>
      <td>18.100000</td>
      <td>0.000000</td>
      <td>0.624000</td>
      <td>6.623500</td>
      <td>94.075000</td>
      <td>5.188425</td>
      <td>24.000000</td>
      <td>666.000000</td>
      <td>20.200000</td>
      <td>396.225000</td>
      <td>16.955000</td>
      <td>25.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>88.976200</td>
      <td>100.000000</td>
      <td>27.740000</td>
      <td>1.000000</td>
      <td>0.871000</td>
      <td>8.780000</td>
      <td>100.000000</td>
      <td>12.126500</td>
      <td>24.000000</td>
      <td>711.000000</td>
      <td>22.000000</td>
      <td>396.900000</td>
      <td>37.970000</td>
      <td>50.000000</td>
    </tr>
  </tbody>
</table>
</div>

<h4 id="histograms-of-the-numerical-features">Histograms of the numerical features</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dataframe</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">));</span>
</code></pre></div></div>

<p><img src="Boston_Black_Fox_files/Boston_Black_Fox_10_0.png" alt="png" /></p>

<h4 id="corelation-heatmap">Corelation heatmap</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">corr</span><span class="p">(),</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
</code></pre></div></div>

<p><img src="Boston_Black_Fox_files/Boston_Black_Fox_12_0.png" alt="png" /></p>

<h4 id="separate-the-data-frame-into-feature-matrix-x-and-dependent-variable-y">Separate the data frame into feature matrix X and dependent variable y</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">X</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">13</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">13</span><span class="p">:</span><span class="mi">14</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</code></pre></div></div>

<h4 id="split-the-entire-data-set-into-the-training-set-and-test-set">Split the entire data set into the training set and test set</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="apply-the-feature-scaling-because-we-dont-wanna-have-any-feature-dominating-another-feature">Apply the feature scaling because we don’t wanna have any feature dominating another feature</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Min Max Scaler
</span><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span>

<span class="n">mms_X</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">()</span>
<span class="n">X_train_minMaxScaled</span> <span class="o">=</span> <span class="n">mms_X</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">X_test_minMaxScaled</span> <span class="o">=</span> <span class="n">mms_X</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="n">mms_y</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">()</span>
<span class="n">y_train_minMaxScaled</span> <span class="o">=</span> <span class="n">mms_y</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">y_train</span><span class="p">)</span>
<span class="n">y_test_minMaxScaled</span> <span class="o">=</span> <span class="n">mms_y</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">y_test</span><span class="p">)</span>
</code></pre></div></div>

<h1 id="option-1---manually-build-ann-using-keras">Option 1 - manually build ANN using Keras</h1>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Importing the keras libraries and packages
</span><span class="kn">import</span> <span class="nn">keras</span>
<span class="kn">from</span> <span class="nn">keras.models</span> <span class="kn">import</span> <span class="n">Sequential</span>
<span class="kn">from</span> <span class="nn">keras.layers</span> <span class="kn">import</span> <span class="n">Dense</span>
<span class="kn">from</span> <span class="nn">keras.callbacks</span> <span class="kn">import</span> <span class="n">Callback</span><span class="p">,</span> <span class="n">TensorBoard</span><span class="p">,</span> <span class="n">ModelCheckpoint</span>
<span class="kn">from</span> <span class="nn">keras.callbacks</span> <span class="kn">import</span> <span class="n">EarlyStopping</span>

<span class="kn">import</span> <span class="nn">time</span>
<span class="n">start1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="n">classifier</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">()</span>
<span class="n">classifier</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span> <span class="o">=</span> <span class="mi">9</span><span class="p">,</span> <span class="n">kernel_initializer</span> <span class="o">=</span> <span class="s">'uniform'</span><span class="p">,</span> <span class="n">activation</span> <span class="o">=</span> <span class="s">'sigmoid'</span><span class="p">,</span> <span class="n">input_dim</span> <span class="o">=</span> <span class="mi">13</span><span class="p">))</span>
<span class="n">classifier</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span> <span class="o">=</span> <span class="mi">9</span><span class="p">,</span> <span class="n">kernel_initializer</span> <span class="o">=</span> <span class="s">'uniform'</span><span class="p">,</span> <span class="n">activation</span> <span class="o">=</span> <span class="s">'sigmoid'</span><span class="p">))</span>
<span class="n">classifier</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span> <span class="o">=</span> <span class="mi">9</span><span class="p">,</span> <span class="n">kernel_initializer</span> <span class="o">=</span> <span class="s">'uniform'</span><span class="p">,</span> <span class="n">activation</span> <span class="o">=</span> <span class="s">'sigmoid'</span><span class="p">))</span>
<span class="n">classifier</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kernel_initializer</span> <span class="o">=</span> <span class="s">'uniform'</span><span class="p">,</span> <span class="n">activation</span> <span class="o">=</span> <span class="s">'sigmoid'</span><span class="p">))</span>
<span class="n">es</span> <span class="o">=</span> <span class="n">EarlyStopping</span><span class="p">(</span><span class="n">monitor</span> <span class="o">=</span> <span class="s">'val_loss'</span><span class="p">,</span>
                   <span class="n">mode</span> <span class="o">=</span> <span class="s">'auto'</span><span class="p">,</span>
                   <span class="n">min_delta</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                   <span class="n">patience</span> <span class="o">=</span> <span class="mi">150</span><span class="p">,</span>
                   <span class="n">verbose</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                   <span class="c1">#baseline=0.4,
</span>                   <span class="n">restore_best_weights</span> <span class="o">=</span> <span class="bp">True</span>
                  <span class="p">)</span>
<span class="n">classifier</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="n">optimizer</span> <span class="o">=</span> <span class="s">'adam'</span><span class="p">,</span> <span class="n">loss</span> <span class="o">=</span> <span class="s">'mean_absolute_error'</span><span class="p">)</span>
<span class="n">classifier</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">X_train_minMaxScaled</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">y_train_minMaxScaled</span><span class="p">,</span> <span class="n">validation_split</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">batch_size</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span> <span class="n">epochs</span> <span class="o">=</span> <span class="mi">3000</span><span class="p">,</span> <span class="n">callbacks</span> <span class="o">=</span> <span class="p">[</span><span class="n">es</span><span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">end1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="n">time1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">end1</span><span class="o">-</span><span class="n">start1</span><span class="p">)</span>
<span class="n">minutes1</span><span class="p">,</span> <span class="n">seconds1</span><span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">time1</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
<span class="n">hours1</span><span class="p">,</span> <span class="n">minutes1</span><span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">minutes1</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Using TensorFlow backend.


Train on 282 samples, validate on 122 samples
Epoch 1/3000
282/282 [==============================] - 2s 6ms/step - loss: 0.1893 - val_loss: 0.2063
Epoch 2/3000
282/282 [==============================] - 0s 137us/step - loss: 0.1824 - val_loss: 0.1995
Epoch 3/3000
282/282 [==============================] - 0s 140us/step - loss: 0.1755 - val_loss: 0.1931
.
.
.
Epoch 2997/3000
282/282 [==============================] - 0s 106us/step - loss: 0.0509 - val_loss: 0.0621
Epoch 2998/3000
282/282 [==============================] - 0s 131us/step - loss: 0.0505 - val_loss: 0.0621
Epoch 2999/3000
282/282 [==============================] - 0s 145us/step - loss: 0.0505 - val_loss: 0.0620
Epoch 3000/3000
282/282 [==============================] - 0s 121us/step - loss: 0.0505 - val_loss: 0.0619
</code></pre></div></div>

<h4 id="plot-loss-during-training">Plot loss during training</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">'Loss'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">classifier</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s">'loss'</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s">'train'</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">'blue'</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">classifier</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s">'val_loss'</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s">'validation'</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">'red'</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="Boston_Black_Fox_files/Boston_Black_Fox_22_0.png" alt="png" /></p>

<h4 id="we-just-trained-our-artificial-neural-network-on-the-training-set-and-now-its-time-to-make-the-prediction-on-the-test-set">We just trained our artificial neural network on the training set and now it’s time to make the prediction on the test set</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">y_pred</span> <span class="o">=</span> <span class="n">classifier</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_minMaxScaled</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"First 6 predicted scaled results are:</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">[:</span><span class="mi">6</span><span class="p">,:])</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>First 6 predicted scaled results are:
 [[0.5606063 ]
 [0.43006495]
 [0.28793135]
 [0.37438512]
 [0.26951233]
 [0.32528967]]
</code></pre></div></div>

<h4 id="restoring-the-results-on-real-values">Restoring the results on real values:</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">y_pred_realValues</span> <span class="o">=</span> <span class="n">mms_y</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">y_pred</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"First 6 real test values are:</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">y_pred_realValues</span><span class="p">[:</span><span class="mi">6</span><span class="p">,:])</span>
<span class="k">print</span><span class="p">(</span><span class="s">"First 6 real test values are:</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">y_test</span><span class="p">[:</span><span class="mi">6</span><span class="p">,:])</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>First 6 real test values are:
 [[30.227283]
 [24.352924]
 [17.956911]
 [21.84733 ]
 [17.128054]
 [19.638035]]
First 6 real test values are:
 [[28.2]
 [23.9]
 [16.6]
 [22. ]
 [20.8]
 [23. ]]
</code></pre></div></div>

<h4 id="compute-error">Compute error</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">t1</span><span class="o">=</span><span class="n">y_pred_realValues</span> <span class="o">-</span> <span class="n">y_test</span>
<span class="n">t2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">t1</span><span class="p">)</span>
<span class="n">t3</span><span class="o">=</span><span class="n">t2</span><span class="o">.</span><span class="nb">sum</span><span class="p">()</span>
<span class="n">t4</span><span class="o">=</span><span class="n">t3</span><span class="o">/</span><span class="p">(</span><span class="mi">102</span><span class="o">*</span><span class="mi">1</span><span class="p">)</span>

<span class="n">t_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="nb">max</span><span class="p">(</span><span class="n">y_test</span><span class="p">)</span>
<span class="n">t_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="nb">min</span><span class="p">(</span><span class="n">y_test</span><span class="p">)</span>

<span class="n">Rmse1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t4</span><span class="p">)</span>
<span class="n">Prmse1</span> <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="n">Rmse1</span><span class="o">/</span><span class="p">(</span><span class="n">t_max</span> <span class="o">-</span> <span class="n">t_min</span><span class="p">))</span>

<span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">Time needed for tuning is "</span><span class="p">,</span> <span class="n">time1</span><span class="p">,</span><span class="s">"seconds("</span><span class="p">,</span><span class="n">hours1</span><span class="p">,</span><span class="s">"hours,"</span><span class="p">,</span><span class="n">minutes1</span><span class="p">,</span><span class="s">"minutes and "</span><span class="p">,</span><span class="n">seconds1</span><span class="p">,</span><span class="s">"seconds)."</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">Root mean square error (Medv) ="</span><span class="p">,</span> <span class="n">Rmse1</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">Percentage root mean square error (Medv) ="</span><span class="p">,</span> <span class="n">Prmse1</span><span class="p">)</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Time needed for tuning is  169 seconds( 0 hours, 2 minutes and  49 seconds).

Root mean square error (Medv) = 4.044688236981178

Percentage root mean square error (Medv) = 9.255579489659445
</code></pre></div></div>

<h4 id="visualisation">Visualisation:</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_pred_realValues</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'real values'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'predicted values'</span><span class="p">)</span>
<span class="n">_</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">55</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">55</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s">"b"</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="Boston_Black_Fox_files/Boston_Black_Fox_30_0.png" alt="png" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">house</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">y_test</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">y_test</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">house</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">y_test</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">y_test</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],)),</span> <span class="n">color</span> <span class="o">=</span> <span class="s">'red'</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">'Real data'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">house</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">y_pred_realValues</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">y_test</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],)),</span> <span class="n">color</span> <span class="o">=</span> <span class="s">'blue'</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">'Predicted data'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">'Real price vs Predicted price'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'House'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'House price in 1000 $'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s">'upper left'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="Boston_Black_Fox_files/Boston_Black_Fox_31_0.png" alt="png" /></p>

<h1 id="option-2---optimize-ann-using-black-fox-service">Option 2 - Optimize ANN using Black Fox service</h1>

<h4 id="install-black-fox-service">Install Black fox service</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pip</span> <span class="n">install</span> <span class="n">blackfox</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Collecting git+https://github.com/tmrdja/BlackFoxPython.git
  Cloning https://github.com/tmrdja/BlackFoxPython.git to /tmp/pip-req-build-sa98_hvs
Requirement already satisfied: urllib3&gt;=1.15 in /home/nbuser/anaconda3_501/lib/python3.6/site-packages (from blackfox==0.0.2) (1.23)
Requirement already satisfied: six&gt;=1.10 in /home/nbuser/anaconda3_501/lib/python3.6/site-packages (from blackfox==0.0.2) (1.11.0)
Requirement already satisfied: certifi in /home/nbuser/anaconda3_501/lib/python3.6/site-packages (from blackfox==0.0.2) (2018.10.15)
Requirement already satisfied: python-dateutil in /home/nbuser/anaconda3_501/lib/python3.6/site-packages (from blackfox==0.0.2) (2.7.5)
Building wheels for collected packages: blackfox
  Building wheel for blackfox (setup.py) ... [?25ldone
[?25h  Stored in directory: /tmp/pip-ephem-wheel-cache-iymnhfo5/wheels/46/d5/ca/47789f92af70d12cb6fc5f0c752e911491b82477816f26da21
Successfully built blackfox
Installing collected packages: blackfox
Successfully installed blackfox-0.0.2
</code></pre></div></div>

<h4 id="lets-run-the-black-fox-service-to-find-best-ann-for-the-specific-problem-note-that-we-optimize-the-architecture-as-well">Let’s run the Black Fox service to find best ANN for the specific problem. Note that we optimize the architecture, as well!</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#BF service
</span><span class="kn">from</span> <span class="nn">blackfox</span> <span class="kn">import</span> <span class="n">BlackFox</span>
<span class="kn">from</span> <span class="nn">blackfox</span> <span class="kn">import</span> <span class="n">KerasOptimizationConfig</span>
<span class="kn">from</span> <span class="nn">blackfox</span> <span class="kn">import</span> <span class="n">OptimizationEngineConfig</span>
<span class="kn">import</span> <span class="nn">h5py</span>
<span class="c1">#from keras.models import load_model
#import numpy as np
#import pandas as pd
</span>
<span class="n">blackfox_url</span> <span class="o">=</span> <span class="s">'http://*******************'</span>
<span class="n">bf</span> <span class="o">=</span> <span class="n">BlackFox</span><span class="p">(</span><span class="n">blackfox_url</span><span class="p">)</span>

<span class="n">ec</span> <span class="o">=</span> <span class="n">OptimizationEngineConfig</span><span class="p">(</span><span class="n">proc_timeout_miliseconds</span><span class="o">=</span><span class="mi">2000000</span><span class="p">,</span> <span class="n">population_size</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">max_num_of_generations</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">KerasOptimizationConfig</span><span class="p">(</span><span class="n">engine_config</span><span class="o">=</span><span class="n">ec</span><span class="p">,</span> <span class="n">max_epoch</span> <span class="o">=</span> <span class="mi">3000</span><span class="p">,</span> <span class="n">validation_split</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">time</span>
<span class="n">start3</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="c1"># Use CTRL + C to stop optimization
</span><span class="p">(</span><span class="n">ann_io</span><span class="p">,</span> <span class="n">ann_info</span><span class="p">,</span> <span class="n">ann_metadata</span><span class="p">)</span> <span class="o">=</span> <span class="n">bf</span><span class="o">.</span><span class="n">optimize_keras_sync</span><span class="p">(</span>
    <span class="n">input_set</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">,</span>
    <span class="n">output_set</span> <span class="o">=</span> <span class="n">y_train</span><span class="p">,</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">c</span><span class="p">,</span>
    <span class="n">integrate_scaler</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
    <span class="n">network_path</span><span class="o">=</span><span class="s">'OptimizedANNBoston_final.h5'</span>
<span class="p">)</span>

<span class="n">end3</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">time3</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">end3</span><span class="o">-</span><span class="n">start3</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">ann info:'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">ann_info</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">ann metadata:'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">ann_metadata</span><span class="p">)</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Use CTRL + C to stop optimization
Uploading data set
Starting...
2019-03-29 07:35:40.804256 -&gt; Active, Generation: 0/20, Validation set error: 0.000000, Training set error: 0.000000, Epoch: 0, Optimization Id: 314edeae-b9a7-4391-85c5-304942833297
2019-03-29 07:39:32.531283 -&gt; Active, Generation: 1/20, Validation set error: 0.058012, Training set error: 0.059058, Epoch: 1325, Optimization Id: 314edeae-b9a7-4391-85c5-304942833297
.
.
.
2019-03-29 07:55:17.990587 -&gt; Active, Generation: 19/20, Validation set error: 0.046831, Training set error: 0.037376, Epoch: 1247, Optimization Id: 314edeae-b9a7-4391-85c5-304942833297
2019-03-29 07:55:23.498422 -&gt; Finished, Generation: 20/20, Validation set error: 0.047627, Training set error: 0.043440, Epoch: 445, Optimization Id: 314edeae-b9a7-4391-85c5-304942833297
stopped Finished
Downloading network 5d184b8e1e23b8f81bdba1e94933469feda9107d
Saving network 5d184b8e1e23b8f81bdba1e94933469feda9107d to OptimizedANNBoston_final.h5

ann info:
{'dropout': 0.01,
 'hidden_layers': [{'activation_function': 'ReLu', 'neuron_count': 10},
                   {'activation_function': 'ReLu', 'neuron_count': 10},
                   {'activation_function': 'ReLu', 'neuron_count': 10}],
 'id': '5d184b8e1e23b8f81bdba1e94933469feda9107d',
 'output_layer_activation_function': 'ReLu',
 'training_algorithm': 'RMSprop'}

ann metadata:
{'__version': 1, 'is_scaler_integrated': False, 'scaler_config': {'input': {'feature_range': [0, 1], 'fit': [[0.00632, 0.0, 0.46, 0.0, 0.385, 3.5610000000000004, 2.9, 1.1296, 1.0, 187.0, 12.6, 0.32, 1.73], [88.9762, 100.0, 27.74, 1.0, 0.871, 8.78, 100.0, 12.1265, 24.0, 711.0, 22.0, 396.9, 37.97]], 'inverse_transform': False}, 'output': {'feature_range': [0, 1], 'fit': [[5.0], [50.0]], 'inverse_transform': True}}, 'scaler_name': 'MinMaxScaler'}
</code></pre></div></div>

<h4 id="the-data-set-passed-to-the-black-fox-service-was-not-scaled-since-black-fox-scales-inputs-automatically-in-order-to-apply-obtained-ann-in-prediction-blackfox-offers-the-utility-function-to-scale-our-test-set-the-same-way">The data set passed to the Black Fox service was not scaled since Black Fox scales inputs automatically. In order to apply obtained ANN in prediction, BlackFox offers the utility function to scale our test set the same way.</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Get metadata
</span><span class="n">meta</span> <span class="o">=</span> <span class="n">bf</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="s">'OptimizedANNBoston_final.h5'</span><span class="p">)</span>
<span class="n">scaler_config</span> <span class="o">=</span> <span class="n">meta</span><span class="p">[</span><span class="s">'scaler_config'</span><span class="p">]</span>

<span class="c1"># Scale
</span><span class="n">x_scaler_config</span> <span class="o">=</span> <span class="n">scaler_config</span><span class="p">[</span><span class="s">'input'</span><span class="p">]</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span> 
<span class="n">min_max_x</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">(</span><span class="n">feature_range</span><span class="o">=</span><span class="n">x_scaler_config</span><span class="p">[</span><span class="s">'feature_range'</span><span class="p">])</span>
<span class="n">min_max_x</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_scaler_config</span><span class="p">[</span><span class="s">'fit'</span><span class="p">])</span>

<span class="n">X_test_minMaxScaled_withBF</span> <span class="o">=</span> <span class="n">min_max_x</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="c1">#print(X_test_minMaxScaled_withBF[:10,:])
</span></code></pre></div></div>

<h4 id="prediction-using-ann-proposed-by-black-fox">Prediction using ANN proposed by Black Fox</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Importing ANN model
</span><span class="kn">from</span> <span class="nn">keras.models</span> <span class="kn">import</span> <span class="n">load_model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">load_model</span><span class="p">(</span><span class="s">'OptimizedANNBoston_final.h5'</span><span class="p">)</span>

<span class="c1"># Prediction
</span><span class="n">y_pred_BF</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_minMaxScaled_withBF</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Prediktovane BF vrednosti su:</span><span class="se">\n\n</span><span class="s">"</span><span class="p">,</span> <span class="n">y_pred_BF</span><span class="p">[:</span><span class="mi">10</span><span class="p">,:])</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Prediktovane BF vrednosti su:

 [[0.5140095 ]
 [0.4982071 ]
 [0.2846269 ]
 [0.324078  ]
 [0.27151382]
 [0.31284016]
 [0.49799612]
 [0.22368902]
 [0.34022993]
 [0.40406382]]
</code></pre></div></div>

<h4 id="rescale">Rescale</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Rescale
</span><span class="n">y_scaler_config</span> <span class="o">=</span> <span class="n">scaler_config</span><span class="p">[</span><span class="s">'output'</span><span class="p">]</span>
<span class="n">min_max_y</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">(</span><span class="n">feature_range</span><span class="o">=</span><span class="n">y_scaler_config</span><span class="p">[</span><span class="s">'feature_range'</span><span class="p">])</span>
<span class="n">min_max_y</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">y_scaler_config</span><span class="p">[</span><span class="s">'fit'</span><span class="p">])</span>

<span class="n">y_pred_BF_realValues</span> <span class="o">=</span> <span class="n">min_max_y</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">y_pred_BF</span><span class="p">)</span>
<span class="c1">#print("\nFirst 6 real predicted values are:\n", y_pred_BF_realValues[:6,:])
</span>
<span class="c1">#y_pred_BF_realValues = mms_y.inverse_transform(y_pred_BF)
#print("\nFirst 6 real predicted values are:\n", y_pred_BF_realValues[:6,:])
</span></code></pre></div></div>

<h4 id="compute-error-1">Compute error</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">t1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">y_pred_BF_realValues</span> <span class="o">-</span> <span class="n">y_test</span><span class="p">)</span>
<span class="n">t2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">t1</span><span class="p">)</span>
<span class="n">t3</span><span class="o">=</span><span class="n">t2</span><span class="o">.</span><span class="nb">sum</span><span class="p">()</span>
<span class="n">t4</span><span class="o">=</span><span class="n">t3</span><span class="o">/</span><span class="p">(</span><span class="mi">102</span><span class="o">*</span><span class="mi">1</span><span class="p">)</span>

<span class="n">t_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="nb">max</span><span class="p">(</span><span class="n">y_test</span><span class="p">)</span>
<span class="n">t_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="nb">min</span><span class="p">(</span><span class="n">y_test</span><span class="p">)</span>
<span class="n">t_max_pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="nb">max</span><span class="p">(</span><span class="n">y_pred_BF</span><span class="p">)</span>
<span class="n">t_min_pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="nb">min</span><span class="p">(</span><span class="n">y_pred_BF</span><span class="p">)</span>

<span class="n">Rmse3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t4</span><span class="p">)</span>
<span class="n">Prmse3</span> <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="n">Rmse3</span><span class="o">/</span><span class="p">(</span><span class="n">t_max</span> <span class="o">-</span> <span class="n">t_min</span><span class="p">))</span>

<span class="n">minutes3</span><span class="p">,</span> <span class="n">seconds3</span><span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">time3</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
<span class="n">hours3</span><span class="p">,</span> <span class="n">minutes3</span><span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">minutes3</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Time for finding the best ANN by Black Fox service is "</span><span class="p">,</span> <span class="n">time3</span><span class="p">,</span><span class="s">"seconds("</span><span class="p">,</span><span class="n">hours3</span><span class="p">,</span><span class="s">"hours,"</span><span class="p">,</span><span class="n">minutes3</span><span class="p">,</span><span class="s">"minutes and "</span><span class="p">,</span><span class="n">seconds3</span><span class="p">,</span><span class="s">"seconds)."</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">Root mean square error (Medv) = "</span><span class="p">,</span> <span class="n">Rmse3</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">Percentage root mean square error (Medv) = "</span><span class="p">,</span> <span class="n">Prmse3</span><span class="p">)</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Time for finding the best ANN by Black Fox service is  1191 seconds( 0 hours, 19 minutes and  51 seconds).

Root mean square error (Medv) =  3.938152738646182

Percentage root mean square error (Medv) =  9.011791163950072
</code></pre></div></div>

<h4 id="visualization">Visualization:</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_pred_BF_realValues</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'real values'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'predicted values'</span><span class="p">)</span>
<span class="n">_</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">55</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">55</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s">"b"</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="Boston_Black_Fox_files/Boston_Black_Fox_46_0.png" alt="png" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">house</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">y_test</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">y_test</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">house</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">y_test</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">y_test</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],)),</span> <span class="n">color</span> <span class="o">=</span> <span class="s">'red'</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">'Real data'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">house</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">y_pred_BF_realValues</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">y_test</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],)),</span> <span class="n">color</span> <span class="o">=</span> <span class="s">'blue'</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">'Predicted data'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">'Real price vs Predicted price'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'House'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'House price in 1000 $'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s">'upper left'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="Boston_Black_Fox_files/Boston_Black_Fox_47_0.png" alt="png" /></p>

<h1 id="results-and-discussion">RESULTS AND DISCUSSION</h1>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s">'ggplot'</span><span class="p">)</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s">'lines'</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s">'font'</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s">'8'</span><span class="p">)</span>

<span class="n">n_groups</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">group_1</span> <span class="o">=</span> <span class="p">(</span><span class="n">Human_time1</span><span class="o">/</span><span class="mi">3600</span><span class="p">,</span> <span class="n">Human_time3</span><span class="o">/</span><span class="mi">3600</span><span class="p">)</span>
<span class="n">group_2</span> <span class="o">=</span> <span class="p">(</span><span class="n">time1</span><span class="o">/</span><span class="mi">3600</span><span class="p">,</span> <span class="n">time3</span><span class="o">/</span><span class="mi">3600</span><span class="p">)</span>
<span class="n">group_3</span> <span class="o">=</span> <span class="p">(</span><span class="n">errorOnTestSetTrained</span><span class="p">,</span> <span class="n">errorOnTestSetBF</span><span class="p">)</span>
 
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
<span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_groups</span><span class="p">)</span>
<span class="n">bar_width</span> <span class="o">=</span> <span class="mf">0.15</span>
<span class="n">space</span> <span class="o">=</span> <span class="mf">0.05</span>
<span class="n">opacity</span> <span class="o">=</span> <span class="mi">1</span>
  

<span class="n">rects1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">group_1</span><span class="p">,</span> <span class="n">bar_width</span><span class="p">,</span>
<span class="n">alpha</span><span class="o">=</span><span class="n">opacity</span><span class="p">,</span>
<span class="n">label</span><span class="o">=</span><span class="s">'Human effort ( h )'</span><span class="p">)</span>

<span class="n">rects2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">group_2</span><span class="p">,</span> <span class="n">bar_width</span><span class="p">,</span><span class="n">bottom</span> <span class="o">=</span><span class="n">group_1</span><span class="p">,</span>
<span class="n">alpha</span><span class="o">=</span><span class="n">opacity</span><span class="p">,</span>
<span class="n">label</span><span class="o">=</span><span class="s">'Execution time ( h )'</span><span class="p">)</span>

<span class="n">rects3</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">index</span> <span class="o">+</span> <span class="n">bar_width</span><span class="o">+</span><span class="n">space</span><span class="p">,</span> <span class="n">group_3</span><span class="p">,</span> <span class="n">bar_width</span><span class="p">,</span>
<span class="n">alpha</span><span class="o">=</span><span class="n">opacity</span><span class="p">,</span>
<span class="n">label</span><span class="o">=</span><span class="s">'RMSE ( 1000 $ )'</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">'Comparison'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">index</span> <span class="o">+</span> <span class="p">(</span><span class="n">bar_width</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">space</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="s">'Manual'</span><span class="p">,</span> <span class="s">'Black Fox service'</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s">'upper center'</span><span class="p">)</span>
 
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="Boston_Black_Fox_files/Boston_Black_Fox_49_0.png" alt="png" /></p>

<h4 id="although-we-measured-this-three-options-actually-they-are-not-so-comparable-because-in-python-we-had-a-man-sitting-in-office-and-programming-those-neural-networks-options-1-and-2-while-in-black-fox-service-option-3-he-imported-the-same-data-set-and-the-service-did-the-rest-while-he-went-to-rest-or-dring-coffe-for-example-so-actually-in-black-fox-service-he-wrote-few-lines-of-code-and-thats-all-of-hard-work-results-in-the-given-plots-above-speak-for-themself-as-you-can-see-black-fox-service-gave-better-results-in-less-time-and-effort-to-create-approximate-results-in-python-as-black-fox-did-is-immeasurably-large">Although we measured this three options, actually they are not so comparable, because in Python we had a man sitting in office and programming those neural networks (options 1 and 2) while in Black Fox service (option 3), he imported the same data set and the service did the rest, while he went to rest or dring coffe, for example, so actually, in Black Fox service he wrote few lines of code and thats all of hard work. Results in the given plots above speak for themself. As you can see, Black Fox service gave better results in less time and effort to create approximate results in Python as Black Fox did is immeasurably large.</h4>



        </div>

        
      </section>

      <footer class="page__meta">
        
        


        
      </footer>

      

      
  <nav class="pagination">
    
      <a href="#" class="pagination--pager disabled">Previous</a>
    
    
      <a href="/blackfox-examples/examples/building/" class="pagination--pager" title="Building Example
">Next</a>
    
  </nav>

    </div>

    
  </article>
  <div>
    <a href="../jupyter/Boston_Black_Fox.ipynb" download>Jupyter notebook</a><br/>
    <a href="../jupyter/Boston_Black_Fox.md" download>Markdown</a>
  </div>

  
  
</div>
    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><input type="search" id="search" aria-placeholder="Enter your search term..." class="search-input" tabindex="-1" placeholder="Enter your search term..." />
    <div id="results" class="results"></div></div>

      </div>
    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
          <li><a href="https://github.com/vodena" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
    

    <li><a href="/blackfox-examples/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2019 Vodéna. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/blackfox-examples/assets/js/main.min.js"></script>
  <script defer src="https://use.fontawesome.com/releases/v5.8.1/js/all.js" integrity="sha384-g5uSoOSBd7KkhAMlnQILrecXvzst9TdC09/VM+pjDTCM+1il8RHz5fKANTFFb+gQ" crossorigin="anonymous"></script>




<script src="/blackfox-examples/assets/js/lunr/lunr.min.js"></script>
<script src="/blackfox-examples/assets/js/lunr/lunr-store.js"></script>
<script src="/blackfox-examples/assets/js/lunr/lunr-en.js"></script>







  </body>
</html>
